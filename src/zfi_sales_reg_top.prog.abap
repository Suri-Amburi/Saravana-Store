*&---------------------------------------------------------------------*
*& Include          ZFI_SALES_REG_TOP
*&---------------------------------------------------------------------*

*&---------------------------------------------------------------------*
*& Include          ZFI_SALES_REG_TOP
*&---------------------------------------------------------------------*
TABLES:VBRK,BSEG.
TYPE-POOLS : SLIS.
DATA: IT_FCAT   TYPE SLIS_T_FIELDCAT_ALV, "WITH HEADER LINE,
      WA_FCAT   TYPE SLIS_FIELDCAT_ALV,
      WA_LAYOUT TYPE SLIS_LAYOUT_ALV.

DATA: WA_EVENTS TYPE SLIS_ALV_EVENT,
      IT_EVENTS TYPE SLIS_T_EVENT,
      IT_SORT   TYPE SLIS_T_SORTINFO_ALV,
      WA_SORT   TYPE SLIS_SORTINFO_ALV.
DATA : I_HEADING TYPE SLIS_T_LISTHEADER .
DATA : WA_HEADING LIKE LINE OF I_HEADING .


TYPES:BEGIN OF TY_VBRK,
        VBELN TYPE VBELN_VF,    ""Billing Document
        FKART TYPE FKART,       "Billing Type
        FKDAT TYPE FKDAT,       ""date
        REGIO TYPE REGIO,       ""region
        KUNRG TYPE KUNRG,       ""Payer
        KUNAG TYPE KUNAG,       ""Sold-to party
        KNUMV TYPE KNUMV,       ""dondition no
        KURRF TYPE VBRK-KURRF , "exch rate
        XBLNR TYPE XBLNR_V1,
        SPART TYPE VBRK-SPART,
        BELNR TYPE VBRK-BELNR,
        GJAHR TYPE VBRK-GJAHR,
*        RFBSK TYPE VBRK-RFBSK,
      END OF TY_VBRK.

TYPES:BEGIN OF TY_VBRP,
        VBELN      TYPE VBELN_VF,    ""Billing Document
        NETWR      TYPE NETWR_FP,
        POSNR      TYPE POSNR_VF,
        MATNR      TYPE	MATNR,
        ARKTX      TYPE ARKTX,
        WERKS      TYPE WERKS_D,
        FKIMG      TYPE FKIMG,
        VRKME      TYPE VRKME,
        SPART      TYPE SPART,
        VTWEG_AUFT TYPE VTWEG_AUFT,
        WAERK      TYPE WAERK,
        AUBEL      TYPE VBRP-AUBEL,
        VGBEL      TYPE VBRP-VGBEL,
        CHARG      TYPE VBRP-CHARG,
        KURSK      TYPE VBRP-KURSK,
        ZZLIN      TYPE char25, "VBRP-ZZLIN,
        ZZDT       TYPE DATUM,  "VBRP-ZZDT,
      END OF TY_VBRP.

TYPES:BEGIN OF TY_KNA1,
        SPRAS      TYPE SPRAS,
        KUNNR      TYPE KUNNR,
        NAME1	     TYPE NAME1_GP,
        NAME2	     TYPE NAME2_GP,
        STCD3      TYPE STCD3,
        ADRNR      TYPE ADRNR,
        REGIO      TYPE REGIO,
        J_1IPANREF TYPE J_1IPANREF,
        LAND1      TYPE LAND1,
        ORT01      TYPE KNA1-ORT01,
        PSTLZ      TYPE KNA1-PSTLZ,
      END OF TY_KNA1.

TYPES:BEGIN OF TY_PRCD,
        KNUMV TYPE  KNUMV,
        KPOSN	TYPE KPOSN,
        KSCHL	TYPE KSCHA,
        KNUMH	TYPE KNUMH,
        KOPOS	TYPE KOPOS_LONG,
        KWERT	TYPE VFPRC_ELEMENT_VALUE,
        KBETR	TYPE VFPRC_ELEMENT_VALUE,
        KKURS TYPE KKURS,
        WAERS TYPE WAERS,
      END OF TY_PRCD.

TYPES:BEGIN OF TY_MARA,
        MATNR TYPE MATNR,
        MTART TYPE MTART,
*        zzmkt type mara-zzmkt,
      END OF TY_MARA.

TYPES:BEGIN OF TY_MARC,
        MATNR TYPE MATNR,
        STEUC TYPE  STEUC,
        WERKS TYPE WERKS_D,
      END OF TY_MARC.
TYPES : BEGIN OF TY_T001W,
          WERKS TYPE WERKS_D,
          NAME1 TYPE NAME1,
        END OF TY_T001W.
TYPES:BEGIN OF TY_MAKT,
        MATNR TYPE MATNR,
        MAKTX TYPE MAKTX,
      END OF TY_MAKT.

TYPES:BEGIN OF TY_VBFA,
        VBELV	  TYPE VBELN_VON,
        VBELN	  TYPE VBELN_NACH,
        VBTYP_V	TYPE VBTYPL_V,
      END OF TY_VBFA.

TYPES:BEGIN OF TY_VBPA,
        VBELN	TYPE VBELN_VA,
        PARVW TYPE PARVW,
        KUNNR	TYPE KUNNR,
        ADRNR	TYPE ADRNR,
      END OF TY_VBPA.

TYPES:BEGIN OF TY_T005U,
        SPRAS TYPE SPRAS,
        LAND1	TYPE LAND1,
        BLAND	TYPE REGIO,
        BEZEI	TYPE BEZEI20,
      END OF TY_T005U.

TYPES:BEGIN OF TY_T604N,
        STEUC TYPE STEUC,
        TEXT1	TYPE BEZEI60,
      END OF TY_T604N.

TYPES:BEGIN OF TY_MSEG,
        MBLNR TYPE MBLNR,
        LIFNR	TYPE LIFNR,
        MATNR TYPE MATNR,
      END OF TY_MSEG.

TYPES:BEGIN OF TY_LFA1,
        LIFNR      TYPE LIFNR,
        LAND1	     TYPE LAND1_GP,
        NAME1	     TYPE NAME1_GP,
        NAME2	     TYPE NAME2_GP,
        STCD3      TYPE STCD3,
        J_1IPANREF TYPE J_1IPANREF,
        REGIO      TYPE REGIO,
      END OF TY_LFA1.

TYPES:BEGIN OF TY_MBEW,
        MATNR TYPE MATNR,
        BWKEY TYPE BWKEY,
        VERPR TYPE VERPR,
        ZPLP1 TYPE DZPLP1,
        ZPLP2	TYPE DZPLP2,
        ZPLP3	TYPE DZPLP3,
        VPRSV TYPE VPRSV,
        STPRS TYPE STPRS,
      END OF TY_MBEW.

TYPES:BEGIN OF TY_J_1IASSVAL,
        J_1IMATNR  TYPE MATNR,
        J_1IVALASS TYPE J_1IVALASS,
        J_1IWAERS  TYPE J_1IWAERS,
      END OF TY_J_1IASSVAL.

TYPES:BEGIN OF TY_BSEG,
        BUKRS	  TYPE BUKRS,
        BELNR	  TYPE BELNR_D,
        GJAHR	  TYPE GJAHR,
        H_BUDAT TYPE BUDAT,
        BSCHL	  TYPE BSCHL,
        BUZEI   TYPE BUZEI,
        KUNNR   TYPE KUNNR,
        VBEL2   TYPE VBELN_VA,
        LIFNR	  TYPE LIFNR,
        MATNR   TYPE MATNR,
        HSN_SAC TYPE J_1IG_HSN_SAC,
        KTOSL   TYPE KTOSL,
        TXGRP	  TYPE TXGRP,
        H_BLART TYPE BLART,
        KOART   TYPE KOART,
        MWSKZ   TYPE MWSKZ,
      END OF TY_BSEG..

TYPES:BEGIN OF T_BSEG,
        BELNR	TYPE BELNR_D,
        GJAHR	TYPE GJAHR,
        BUZID TYPE BSEG-BUZID,
        KOART TYPE BSEG-KOART,
        DMBTR TYPE BSEG-DMBTR,
        TXGRP TYPE BSEG-TXGRP,
      END OF T_BSEG.

TYPES:BEGIN OF TY_BKPF,
        BUKRS	TYPE BUKRS,
        BELNR	TYPE BELNR_D,
        GJAHR	TYPE GJAHR,
        BLART	TYPE BLART,
        BUDAT	TYPE BUDAT,                 "Posting Date in the Document
      END OF TY_BKPF.

TYPES:BEGIN OF TY_BSET,
        BUKRS	TYPE BUKRS,
        BELNR	TYPE BELNR_D,
        GJAHR	TYPE GJAHR,
        HWBAS	TYPE HWBAS_BSES,
        HWSTE	TYPE HWSTE,
        KSCHL TYPE KSCHL,
        KBETR TYPE KBETR_TAX,
        BUZEI TYPE BUZEI,
        KTOSL TYPE KTOSL,
        TXGRP	TYPE TXGRP,
        SHKZG TYPE SHKZG,
      END OF TY_BSET.

TYPES:BEGIN OF T_BSET,
        BELNR	TYPE BELNR_D,
        GJAHR	TYPE GJAHR,
        HWSTE	TYPE HWSTE,
        KSCHL TYPE KSCHL,
      END OF T_BSET.

TYPES:BEGIN OF TY_VBAP,
        VBELN	TYPE VBELN_VA,
        MATNR	TYPE MATNR,
      END OF TY_VBAP.

TYPES:BEGIN OF TY_FIN,
        SLNO         TYPE CHAR5,
        SKUNNR       TYPE CHAR100,
        BKUNNR       TYPE CHAR100,
        VBELN        TYPE VBELN_VF,
        REGIO        TYPE REGIO,     ""POS
        INDYS        TYPE CHAR4,
        FKDAT        TYPE FKDAT,
        TOTVAL       TYPE KWERT,
        FKART        TYPE FKART,       "Billing Type
        STEUC        TYPE STEUC,
        MATNR        TYPE VBRP-MATNR,
        ARKTX        TYPE ARKTX,
        MAKTX        TYPE MAKTX,
        TAXBL        TYPE KWERT,
        BASE_AMT1    TYPE NETWR_FP,     "TAXABLE AMT
        SGST         TYPE KWERT,
        SGSTP        TYPE KWERT,
        CGSTP        TYPE KWERT,
        CGST         TYPE KWERT,
        IGST         TYPE KWERT,
        IGSTP        TYPE KWERT,
        UTGST        TYPE KWERT,
        UTGSTP       TYPE KWERT,
        CONVCHG      TYPE KWERT,
        GDSVR        TYPE CHAR50,
        STCD3        TYPE STCD3,
        STCD31       TYPE STCD3,
        REGIO1       TYPE CHAR50,
        XBLNR        TYPE XBLNR,
        BEZEI        TYPE BEZEI20,
        BEZEI1       TYPE BEZEI20,
        POSNR        TYPE POSNR_VF,
        KUNNR	       TYPE KUNNR,
        FKIMG        TYPE FKIMG,
        VRKME        TYPE VRKME,
        SPART        TYPE SPART,
        WERKS        TYPE WERKS_D,
        VTWEG_AUFT   TYPE VTWEG_AUFT,
        TOTGST       TYPE KWERT,
        TEXT1        TYPE TEXT1,
        CHARGE       TYPE CHARG_D,
        CHARG        TYPE CHARG_D,
        U_RATE       TYPE KWERT,
        DISC         TYPE VFPRC_ELEMENT_VALUE,
        BASE_AMT     TYPE VFPRC_ELEMENT_VALUE,
        FREIGHT      TYPE VFPRC_ELEMENT_VALUE,
        INS_COST     TYPE VFPRC_ELEMENT_VALUE,
        ANT_DUMP     TYPE VFPRC_ELEMENT_VALUE,
        BAS_CUST     TYPE VFPRC_ELEMENT_VALUE,
        TAX_AMT      TYPE VFPRC_ELEMENT_VALUE,
        EXCH_RATE    TYPE KURSF,
        EXCH_RTEXT   TYPE CHAR100,
        CONV_AMT     TYPE KWERT,
        CONV_AMT1    TYPE KWERT , "c LENGTH 20,
        BUPLA        TYPE BUPLA,
        TDS_AMT      TYPE KWERT,
        CMS_AMT      TYPE KWERT,
        SPC_DISC     TYPE KWERT,
        RATE_DIF     TYPE KWERT,
        TAX_SOURCE   TYPE KWERT,
        WAERS        TYPE WAERS,
        MAT_VALUE    TYPE KWERT,
        VBELN1       TYPE VBELN,
        BP           TYPE KNA1-KUNNR,
        BPNAME       TYPE KNA1-NAME1,
        BPSTCD3      TYPE KNA1-STCD3,
        BPCNTRY      TYPE BEZEI,
        BPREGIO      TYPE BEZEI,
        SOPREGIO     TYPE BEZEI,
        SOPCNTRY     TYPE BEZEI,
        TBILLENT     TYPE CHAR250,
        TSHP         TYPE CHAR250,
        BNAME        TYPE T001W-NAME1,
        VTEXT        TYPE TSPAT-VTEXT,
        AUART        TYPE VBAK-AUART,
        SHDP         TYPE KNA1-KUNNR,
*        SHNAME     TYPE KNA1-NAME1,
        SHRT0        TYPE KNA1-ORT01,
        SHPSTLZ      TYPE KNA1-PSTLZ,
        SHREGIO      TYPE T005U-BEZEI,
        SHSTCD3      TYPE KNA1-STCD3,
        TDLNR        TYPE VTTK-TDLNR,
        TRNAME1      TYPE LFA1-NAME1,
        SIGNI        TYPE VTTK-SIGNI,
        LRNO         TYPE CHAR200,
*        zzmkt type mara-zzmkt,
        MERGE        TYPE CHARG_D,
        GRADE        TYPE CHARG_D,
        CRTONS       TYPE VEKP-EXIDV,
        TUBES        TYPE I,
        EWAYB        TYPE C LENGTH 250,
        BUDAT        TYPE BUDAT,
        SHBILLNO     TYPE VTTK-EXTI1,
        SFBILLDAT    TYPE VTTK-EXTI2,
        TNDR_TRKID   TYPE VTTK-TNDR_TRKID,
        AWBILLNO     TYPE VTTK-TEXT1,
        AWBILLDAT    TYPE VTTK-TEXT2,

        SPNAME       TYPE KNA1-NAME1,
        SPREGION     TYPE T005U-BEZEI,
        SPCOUNTRY    TYPE T005U-LAND1,
        SHNAME       TYPE KNA1-NAME1,
        SHGST        TYPE KNA1-STCD3,
        TVALUE       TYPE DMBTR,
        FVALUE       TYPE VFPRC_ELEMENT_VALUE,
        DVALUE       TYPE VFPRC_ELEMENT_VALUE,
        IVALUE       TYPE VFPRC_ELEMENT_VALUE,
        CVALUE       TYPE VFPRC_ELEMENT_VALUE,
        IGSTVAL      TYPE BSET-HWSTE,
        SGSTVAL      TYPE BSET-HWSTE,
        CGSTVAL      TYPE BSET-HWSTE,
        UGSTVAL      TYPE BSET-HWSTE,
        TOTALINVOICE TYPE DMBTR,
        LICNO        TYPE CHAR25,
        LICDATE      TYPE DATUM,
        EWAYBILLNO   TYPE CHAR30,
        EWAYBILLDAT  TYPE CHAR15,
      END OF TY_FIN.


DATA : V_TDNAME  TYPE THEAD-TDNAME,
       LV_TDNAME TYPE THEAD-TDNAME,
       IT_LINE   LIKE TLINE OCCURS 0 WITH HEADER LINE.

DATA:COUNT        TYPE CHAR5,
     LV_VBELN     TYPE VBELN,
     LV_VBELN1    TYPE THEAD-TDNAME,
     WA_CHAR      TYPE CLBATCH,
     IT_CHAR      TYPE TABLE OF CLBATCH,
     LV_EWBILLNO  TYPE CHAR30,
     LV_EWBILLDAT TYPE CHAR15.
*     it_line   TYPE TABLE OF tline,
*     wa_line   TYPE  tline.
DATA:GZPAC     TYPE KWERT,
     GZPAC1    TYPE KWERT,
     GZPA      TYPE KWERT,
     GZINC     TYPE KWERT,
     GZIN      TYPE KWERT,
     GZFCH     TYPE KWERT,
     GZFC      TYPE KWERT,
     GZPRI     TYPE KWERT,
     GZCPO     TYPE KWERT,
     GTOTL     TYPE KWERT,
     GTOTL1    TYPE KWERT,
     GTOTL2    TYPE KWERT,
     SGST      TYPE KWERT,
     SGSTP     TYPE KWERT,
     CGST      TYPE KWERT,
     CGSTP     TYPE KWERT,
     IGST      TYPE KWERT,
     IGSTP     TYPE KWERT,
     UTGST     TYPE KWERT,
     UTGSTP    TYPE KWERT,
     SGSTPT    TYPE KWERT,
     CGSTPT    TYPE KWERT,
     IGSTPT    TYPE KWERT,
     UTGSTPT   TYPE KWERT,
     INPUTRCM  TYPE SHKZG,
     INPUTRCM1 TYPE SHKZG,



     TAXZESS   TYPE CMS_DTE_ORIGINAL_AMT,
     TAXZESS1  TYPE CMS_DTE_ORIGINAL_AMT,
     GDSVR1    TYPE CHAR50,
     ROUNDOF   TYPE PC207-BETRG,
     ROUNDOF1  TYPE PC207-BETRG,
     ROUND     TYPE PC207-BETRG,
     TAXBL2    TYPE KBETR,
     TAXBL3    TYPE KBETR,
     TAXBL4    TYPE KBETR,
     TAXBL5    TYPE KBETR,
     TOTGST1   TYPE KBETR.

TYPES:BEGIN OF TY_VBAK,
        VBELN TYPE VBELN,
        AUART TYPE AUART,
      END OF TY_VBAK.

DATA:WA_VBRK       TYPE TY_VBRK,
     IT_VBRK       TYPE TABLE OF TY_VBRK,
     IT_VBAK       TYPE TABLE OF TY_VBAK,
     WA_VBAK       TYPE TY_VBAK,
     IT_TSPAT      TYPE TABLE OF TSPAT,
     WA_TSPAT      TYPE TSPAT,
     IT_TVAKT      TYPE TABLE OF TVAKT,
     WA_TVAKT      TYPE TVAKT,
     IT_VTTK       TYPE TABLE OF VTTK,
     IT_VTTK1      TYPE TABLE OF VTTK,
     WA_VTTK       TYPE VTTK,
     WA_VTTK1      TYPE VTTK,
     IT_VTTP       TYPE TABLE OF VTTP,
     IT_VTTP1      TYPE TABLE OF VTTP,
     WA_VTTP       TYPE VTTP,
     WA_VTTP1      TYPE VTTP,
     IT_T001W      TYPE TABLE OF TY_T001W,
     WA_T001W      TYPE TY_T001W,
     WA_VBRP       TYPE TY_VBRP,
     IT_VBRP       TYPE TABLE OF TY_VBRP,
     WA_PRCD       TYPE TY_PRCD,
     W_PRCDT1      TYPE PRCD_ELEMENTS,
     W_PRCDT       TYPE PRCD_ELEMENTS,
     T_PRCDT       TYPE TABLE OF PRCD_ELEMENTS,
     T_PRCDT1      TYPE TABLE OF PRCD_ELEMENTS,
     IT_PRCD       TYPE TABLE OF TY_PRCD,
     WA_KNA1       TYPE TY_KNA1,
     WA_KNA12      TYPE TY_KNA1,
     IT_KNA1       TYPE TABLE OF TY_KNA1,
     IT_KNA12      TYPE TABLE OF TY_KNA1,
     WA_MARA       TYPE TY_MARA,
     IT_MARA       TYPE TABLE OF TY_MARA,
     WA_MARC       TYPE TY_MARC,
     IT_MARC       TYPE TABLE OF TY_MARC,
     WA_MAKT       TYPE TY_MAKT,
     IT_MAKT       TYPE TABLE OF TY_MAKT,
     IT_VBPA       TYPE TABLE OF TY_VBPA,
     IT_VBPA1      TYPE TABLE OF TY_VBPA,
     WA_VBFA       TYPE TY_VBFA,
     IT_VBFA       TYPE TABLE OF TY_VBFA,
     WA_VBPA       TYPE TY_VBPA,
     WA_VBPA1      TYPE TY_VBPA,
     WA_FIN        TYPE TY_FIN,
     WA_FIN1       TYPE TY_FIN,
     WA_FIN2       TYPE TY_FIN,
     IT_FIN        TYPE TABLE OF TY_FIN,
     IT_FIN1       TYPE TABLE OF TY_FIN,
     IT_FIN2       TYPE TABLE OF TY_FIN,
     WA_T005U      TYPE TY_T005U,
     WA_T005U1     TYPE T005U,
     IT_T005U      TYPE TABLE OF TY_T005U,
     PF_T005U      TYPE TABLE OF TY_T005U,
     IT_T005U1     TYPE TABLE OF T005U,
     WA_T005U_SP   TYPE TY_T005U,
     IT_T005U_SP   TYPE TABLE OF TY_T005U,
     IT_T604N      TYPE TABLE OF TY_T604N,
     WA_T604N      TYPE TY_T604N,
     IT_MSEG       TYPE TABLE OF TY_MSEG,
     WA_MSEG       TYPE TY_MSEG,
     WA_LFA1       TYPE TY_LFA1,
     IT_LFA1       TYPE TABLE OF TY_LFA1,
     IT_MBEW       TYPE TABLE OF TY_MBEW,
     WA_MBEW       TYPE  TY_MBEW,
     WA_J_1IASSVAL TYPE  TY_J_1IASSVAL,
     IT_J_1IASSVAL TYPE TABLE OF TY_J_1IASSVAL,
     IT_BSEG1      TYPE TABLE OF TY_BSEG,
     IT_BSEG       TYPE TABLE OF TY_BSEG,
     WA_BSEG       TYPE TY_BSEG,
     WA_BSEG1      TYPE TY_BSEG,
     LT_BSEG       TYPE TABLE OF T_BSEG,
     LS_BSEG       TYPE T_BSEG,
     LT_BSET       TYPE TABLE OF T_BSET,
     LS_BSET       TYPE T_BSET,
     IT_BSET       TYPE TABLE OF TY_BSET,
     WA_BSET       TYPE TY_BSET,
     IT_BKPF       TYPE TABLE OF TY_BKPF,
     WA_BKPF       TYPE TY_BKPF,
     WA_VBAP       TYPE TY_VBAP,
     TLQUA         TYPE TABLE OF LQUA,
     WA_TLQUA      TYPE LQUA,
*     TPACK         LIKE ZPACK_INIT OCCURS 0 WITH HEADER LINE,
*     WA_TPACK      TYPE ZPACK_INIT,
*     TPACK1        LIKE ZPACK_INIT OCCURS 0 WITH HEADER LINE,
     IT_VBAP       TYPE TABLE OF TY_VBAP,
     TDOBNAME      TYPE TDOBNAME,
     WA_TLINE      TYPE TLINE,
     IT_TLINE      TYPE TABLE OF TLINE.

DATA : TABIX   TYPE SY-TABIX,
       TINDEX  TYPE SY-TABIX,
       TINDEX1 TYPE SY-TABIX,
       TUBEST  TYPE I.
